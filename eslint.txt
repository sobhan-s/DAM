FROM node:22-alpine

WORKDIR /app

RUN corepack enable && corepack prepare pnpm@latest --activate

# ENV NODE_ENV=production

# Copy everything
COPY pnpm-lock.yaml pnpm-workspace.yaml package.json ./
COPY apps ./apps
COPY packages ./packages

# Install dependencies
RUN pnpm install --frozen-lockfile

# Build gatewayApi
RUN pnpm --filter gatewayApi... build

EXPOSE 8000

CMD ["pnpm", "--filter", "gatewayApi", "start"]
